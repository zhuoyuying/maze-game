<!DOCTYPE html>
<html>
<head>
    <title>迷宫游戏</title>
    <meta charset="utf-8">
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #2c1810;
        }
        canvas {
            border: 2px solid #8b4513;
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.5);
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 800;
        canvas.height = 600;
        
        let gameState = 'menu';
        
        const CELL_SIZE = 40;
        const COLS = 15;
        const ROWS = 15;
        let maze = Array(ROWS).fill().map(() => Array(COLS).fill(1));
        let player = { x: 1, y: 1 };
        let apple = { x: COLS-2, y: ROWS-2 };
        
        function generateMaze() {
            for(let y = 0; y < ROWS; y++) {
                for(let x = 0; x < COLS; x++) {
                    maze[y][x] = 1;
                }
            }
            
            function carve(x, y) {
                maze[y][x] = 0;
                
                const directions = [
                    [0, -2],
                    [2, 0],
                    [0, 2],
                    [-2, 0]
                ];
                
                for(let i = directions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [directions[i], directions[j]] = [directions[j], directions[i]];
                }
                
                for(const [dx, dy] of directions) {
                    const newX = x + dx;
                    const newY = y + dy;
                    
                    if(newX > 0 && newX < COLS-1 && newY > 0 && newY < ROWS-1 && maze[newY][newX] === 1) {
                        maze[y + dy/2][x + dx/2] = 0;
                        carve(newX, newY);
                    }
                }
            }
            
            carve(1, 1);
            maze[1][1] = 0;
            maze[ROWS-2][COLS-2] = 0;
        }
        
        function drawMaze() {
            ctx.fillStyle = '#2c1810';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const offsetX = (canvas.width - COLS * CELL_SIZE) / 2;
            const offsetY = (canvas.height - ROWS * CELL_SIZE) / 2;
            
            for(let y = 0; y < ROWS; y++) {
                for(let x = 0; x < COLS; x++) {
                    if(maze[y][x] === 1) {
                        ctx.fillStyle = '#8b4513';
                        ctx.fillRect(
                            offsetX + x * CELL_SIZE,
                            offsetY + y * CELL_SIZE,
                            CELL_SIZE,
                            CELL_SIZE
                        );
                        
                        ctx.fillStyle = '#654321';
                        ctx.fillRect(
                            offsetX + x * CELL_SIZE + 5,
                            offsetY + y * CELL_SIZE + 5,
                            CELL_SIZE - 5,
                            CELL_SIZE - 5
                        );
                    }
                }
            }
        }
        
        function drawPlayer() {
            const offsetX = (canvas.width - COLS * CELL_SIZE) / 2;
            const offsetY = (canvas.height - ROWS * CELL_SIZE) / 2;
            
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(
                offsetX + player.x * CELL_SIZE + CELL_SIZE/2,
                offsetY + player.y * CELL_SIZE + CELL_SIZE/2,
                CELL_SIZE/3,
                0,
                Math.PI * 2
            );
            ctx.fill();
        }
        
        function drawApple() {
            const offsetX = (canvas.width - COLS * CELL_SIZE) / 2;
            const offsetY = (canvas.height - ROWS * CELL_SIZE) / 2;
            
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(
                offsetX + apple.x * CELL_SIZE + CELL_SIZE/2,
                offsetY + apple.y * CELL_SIZE + CELL_SIZE/2,
                CELL_SIZE/3,
                0,
                Math.PI * 2
            );
            ctx.fill();
        }
        
        function drawMenu() {
            ctx.fillStyle = '#2c1810';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#8b4513';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('迷宫游戏', canvas.width/2, canvas.height/3);
            
            ctx.font = '24px Arial';
            ctx.fillText('点击开始游戏', canvas.width/2, canvas.height/2);
        }
        
        function drawVictory() {
            ctx.fillStyle = '#2c1810';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#8b4513';
            ctx.font = '48px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('恭喜胜利！', canvas.width/2, canvas.height/3);
            
            ctx.font = '24px Arial';
            ctx.fillText('点击重新开始', canvas.width/2, canvas.height/2);
        }
        
        function gameLoop() {
            if(gameState === 'menu') {
                drawMenu();
            } else if(gameState === 'playing') {
                drawMaze();
                drawApple();
                drawPlayer();
            } else if(gameState === 'victory') {
                drawVictory();
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        document.addEventListener('keydown', (e) => {
            if(gameState !== 'playing') return;
            
            let newX = player.x;
            let newY = player.y;
            
            switch(e.key) {
                case 'ArrowUp':
                    newY--;
                    break;
                case 'ArrowDown':
                    newY++;
                    break;
                case 'ArrowLeft':
                    newX--;
                    break;
                case 'ArrowRight':
                    newX++;
                    break;
            }
            
            if(newX >= 0 && newX < COLS && newY >= 0 && newY < ROWS && maze[newY][newX] === 0) {
                player.x = newX;
                player.y = newY;
                
                if(player.x === apple.x && player.y === apple.y) {
                    gameState = 'victory';
                }
            }
        });
        
        canvas.addEventListener('click', () => {
            if(gameState === 'menu' || gameState === 'victory') {
                gameState = 'playing';
                generateMaze();
                player = { x: 1, y: 1 };
                apple = { x: COLS-2, y: ROWS-2 };
            }
        });
        
        generateMaze();
        gameLoop();
    </script>
</body>
</html>
